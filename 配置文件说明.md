# QAX监控配置文件说明

## 概述

QAX监控脚本支持标准HTTP请求格式的配置文件，可以更方便地从浏览器开发者工具中直接复制配置信息。

## 支持的配置文件格式

### ✅ 标准HTTP请求格式（推荐）

```http
POST /data.html HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate, br, zstd
Accept-Language: zh-CN,zh;q=0.9,zh-TW;q=0.8
Connection: keep-alive
Content-Length: 247
Content-Type: application/json; charset=UTF-8
Cookie: __s_sessionid__=a538b36ab3e36f61a1d557d287f35fb7
Host: 30.128.74.13
Origin: https://30.128.74.13
Referer: https://30.128.74.13/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
X-Requested-With: XMLHttpRequest
token: 8f4c4db16b588daa4e219fcc00cb11c2

[{"head":{"function":"export_log_threat","module":"stored","page_index":1,"page_size":10000},"body":{"log_show":{"filter":"((threat_type eq '全部威胁类型'))","time_start":"2025-10-11 14:12:10","time_end":"2100-01-01 10:59:59","order":"descend","password":""}}}]
```

### ✅ 旧格式兼容（向后兼容）

```text
:authority:
30.128.74.13
:method:
POST
:path:
/data.html
:scheme:
https
cookie:
__s_sessionid__=a8e1a1b79822b085e12a4d407e0ed0fe
token:
a2d6617e42197c7c503a4f4c3f0efb93
```

## 必需字段

无论使用哪种格式，配置文件都必须包含以下三个字段：

| 字段名 | 标准格式 | 旧格式 | 说明 |
|--------|----------|--------|------|
| IP地址 | `Host: 30.128.74.13` | `:authority:` + 下一行 | QAX设备的IP地址 |
| 认证令牌 | `token: xxxxxx` | `token:` + 下一行 | 认证Token |
| 会话Cookie | `Cookie: xxxxxx` | `cookie:` + 下一行 | 会话Cookie |

## 设备间隔时间设置

通过文件名设置设备特定的监控间隔时间：

```
configs/
├── 主设备.txt          # 使用默认间隔时间
├── 备用设备-20.txt     # 间隔时间：20分钟
├── 测试设备-5.txt      # 间隔时间：5分钟
└── 监控设备-30.txt     # 间隔时间：30分钟
```

**命名规则**：
- 文件名格式：`设备名-间隔时间.txt`
- 如果文件名包含数字后缀，会自动解析为间隔时间
- 如果文件名没有数字后缀，则使用默认间隔时间

## 快速配置步骤

### 方法一：从cURL命令提取

1. 打开浏览器，访问QAX设备管理界面
2. 按F12打开开发者工具，切换到Network标签
3. 执行一次日志导出操作
4. 在Network中找到`/data.html`的POST请求
5. 右键点击请求 → Copy → Copy as cURL (bash)
6. 从cURL命令中提取以下字段：
   ```bash
   -H 'Cookie: __s_sessionid__=xxx' \
   -H 'Host: 30.128.74.13' \
   -H 'token: xxxxxx' \
   ```
7. 创建配置文件并保存到configs目录

### 方法二：直接复制HTTP请求

1. 在浏览器开发者工具中找到`/data.html`请求
2. 右键点击请求 → Copy → Copy request headers
3. 粘贴到文本文件中
4. 添加请求体JSON数据
5. 保存为.txt文件并放入configs目录

## 配置示例

### 示例1：主设备配置（使用默认间隔）

**文件名**: `configs/主设备.txt`

```http
POST /data.html HTTP/1.1
Cookie: __s_sessionid__=a538b36ab3e36f61a1d557d287f35fb7
Host: 30.128.74.13
token: 8f4c4db16b588daa4e219fcc00cb11c2
Content-Type: application/json; charset=UTF-8

[{"head":{"function":"export_log_threat","module":"stored","page_index":1,"page_size":10000},"body":{"log_show":{"filter":"((threat_type eq '全部威胁类型'))","time_start":"2025-10-11 14:12:10","time_end":"2100-01-01 10:59:59","order":"descend","password":""}}}]
```

### 示例2：备用设备配置（20分钟间隔）

**文件名**: `configs/备用设备-20.txt`

```http
POST /data.html HTTP/1.1
Cookie: __s_sessionid__=b8e1a1b79822b085e12a4d407e0ed0ff
Host: 30.128.74.14
token: b8e1a1b79822b085e12a4d407e0ed0ff
Content-Type: application/json; charset=UTF-8

[{"head":{"function":"export_log_threat","module":"stored","page_index":1,"page_size":10000},"body":{"log_show":{"filter":"((threat_type eq '全部威胁类型'))","time_start":"2025-10-11 14:12:10","time_end":"2100-01-01 10:59:59","order":"descend","password":""}}}]
```

## 注意事项

1. **文件编码**: 配置文件必须使用UTF-8编码保存
2. **Token有效性**: 确保提供的token有效且未过期
3. **Cookie时效性**: Cookie可能会过期，需要定期更新
4. **网络连接**: 确保能够访问所有QAX设备的IP地址
5. **格式兼容**: 脚本同时支持新旧格式，可以混合使用

## 故障排除

### 配置文件解析失败

**错误信息**: `配置文件 xxx.txt 缺少必要字段`

**解决方法**:
1. 检查文件是否包含必需的三个字段：Host、token、Cookie
2. 确认字段格式正确（`Host: IP地址`）
3. 检查文件编码是否为UTF-8
4. 使用调试模式查看详细解析过程：`--debug`

### 设备连接失败

**错误信息**: 网络连接或认证失败

**解决方法**:
1. 检查设备IP地址是否正确
2. 确认Token和Cookie是否有效
3. 测试网络连通性：`ping 设备IP`
4. 更新过期的Token和Cookie